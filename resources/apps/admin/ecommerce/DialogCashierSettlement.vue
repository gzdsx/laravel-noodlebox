<template>
    <el-dialog
            :title="$t('transaction.cashier_settlement')"
            width="75%"
            :visible="value"
            :close-on-click-modal="false"
            :close-on-press-escape="false"
            append-to-body
            closeable
            @close="$emit('input', false)"
    >
        <el-descriptions title="" direction="vertical" :column="4" border>
            <el-descriptions-item :label="$t('transaction.base_amount')">{{ settlement.pos_base_amount }}</el-descriptions-item>
            <el-descriptions-item :label="$t('transaction.shipping_total')">{{ settlement.shipping_total }}</el-descriptions-item>
            <el-descriptions-item :label="$t('transaction.cash_total')">{{ settlement.cash_total }}</el-descriptions-item>
            <el-descriptions-item :label="$t('transaction.online_total')">{{ settlement.online_total }}</el-descriptions-item>
            <el-descriptions-item :label="$t('transaction.card_total')">{{ settlement.card_total }}</el-descriptions-item>
            <el-descriptions-item :label="$t('transaction.total')">{{ settlement.total }}</el-descriptions-item>
            <el-descriptions-item :label="$t('transaction.refund_total')">{{ settlement.refund_total }}</el-descriptions-item>
            <el-descriptions-item :label="$t('transaction.cash_profit_total')">{{ settlement.cash_profit_total }}</el-descriptions-item>
        </el-descriptions>
        <el-form size="medium" label-position="top" style="margin-top:20px;">
            <el-form-item :label="$t('transaction.notes')">
                <el-input v-model="notes" type="textarea" rows="3" class="w500" placeholder=""/>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" @click="handleSubmit">Submit</el-button>
            </el-form-item>
        </el-form>
    </el-dialog>
</template>

<script>
import transaction from "../trade/Transaction.vue";
import ApiService from "../utils/ApiService";

export default {
    name: "DialogCashierSettlement",
    computed: {
        transaction() {
            return transaction
        }
    },
    props: {
        value: {
            type: Boolean,
            default: false
        }
    },
    data() {
        return {
            settlement: {
                pos_base_amount: 0,
                shipping_total: 0,
                cash_total: 0,
                online_total: 0,
                card_total: 0,
                cost_total: 0,
                total: 0,
                refund_total: 0,
                cash_profit_total: 0
            },
            notes: ''
        }
    },
    watch:{
        value(val) {
            if (val) {
                this.fetchSettlement();
            }
        }
    },
    methods: {
        handleSubmit() {
            ApiService.post('/cashier/transactions', {
                notes: this.notes
            }).then(() => {
                this.$message.success('Settlement success');
                this.$emit('input', false);
            });
        },
        fetchSettlement() {
            ApiService.get('/cashier/calculate').then(response => {
                this.settlement = {
                    ...this.settlement,
                    ...response.data
                };
            });
        }
    },
    mounted() {

    }
}
</script>

<style scoped>

</style>